<!DOCTYPE html><html><head><link href="/images/favicon.png" rel="icon" type="image/png" /><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="ROM &raquo; Blog &raquo; ROM 0.6.1 Released via @rom_rb" name="twitter:description" /><meta content="ROM &raquo; Blog &raquo; ROM 0.6.1 Released" name="description" /><title>ROM &raquo; Blog &raquo; ROM 0.6.1 Released</title><style type="text/css">.highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #d0d0d0;
  background-color: #151515;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}</style><link href="../../../../../stylesheets/all.css" rel="stylesheet" /><script src="../../../../../javascripts/all.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script><script>$(function() {
  var share = new Share(".share")
});
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2573270-5', 'auto');
ga('send', 'pageview');</script></head><body class="blog blog_2015 blog_2015_04 blog_2015_04_04 blog_2015_04_04_rom-0-6-1-released blog_2015_04_04_rom-0-6-1-released_index"><div class="page-wrapper"><header><nav class="navbar navbar-default navbar-static-top"><div class="navbar-inner"><div class="container"><a class="navbar-brand" href="/">Ruby Object Mapper</a><ul class="nav navbar-nav"><li class=""><a class="" href="/introduction">Introduction</a></li><li class=""><a class="" href="/guides">Guides</a></li><li class=""><a class="" href="/tutorials">Tutorials</a></li><li class="dropdown"><a class="dropdown-toggle" role="button" data-toggle="dropdown" href="#">API Reference <span class='caret'/></a><ul class="dropdown-menu" role="menu"><li><a href="http://www.rubydoc.info/gems/rom">rom</a></li><li><a href="http://www.rubydoc.info/gems/rom-sql">rom-sql</a></li><li><a href="http://www.rubydoc.info/gems/rom-yesql">rom-yesql</a></li><li><a href="http://www.rubydoc.info/gems/rom-influxdb">rom-influxdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-event_store">rom-event_store</a></li><li><a href="http://www.rubydoc.info/gems/rom-rethinkdb">rom-rethinkdb</a></li><li><a href="http://www.rubydoc.info/gems/rom-mongo">rom-mongo</a></li><li><a href="http://www.rubydoc.info/gems/rom-redis">rom-redis</a></li><li><a href="http://www.rubydoc.info/gems/rom-csv">rom-csv</a></li><li><a href="http://www.rubydoc.info/gems/rom-yaml">rom-yaml</a></li><li><a href="http://www.rubydoc.info/gems/rom-dm">rom-dm</a></li><li><a href="http://www.rubydoc.info/gems/rom-lotus">rom-lotus</a></li><li><a href="http://www.rubydoc.info/gems/rom-rails">rom-rails</a></li><li><a href="http://www.rubydoc.info/gems/rom-roda">rom-roda</a></li></ul></li><li class=""><a class="" href="/blog">Blog</a></li><li class=""><a class="" href="/contribute">Contribute</a></li><li class=""><a class="" href="/status">Status</a></li></ul></div></div></nav></header><div class="container"><div class="content"><div class="blog"><div class="row"><div class="col-md-8"><section class="articles"><article><header><h1>ROM 0.6.1 Released</h1><div class="article-meta">Published on April 04, 2015 by <a href="https://twitter.com/maetl">Mark Rickerby</a> under <a class="tag" href="/blog/tags/release/">release</a> <a class="tag" href="/blog/tags/announcement/">announcement</a></div></header><hr /><div class="article-body"><p>We’re pleased to announce that ROM 0.6.1 is now available, building on the <a href="/blog/2015/03/23/rom-0-6-0-released/">improvements and API changes in 0.6.0</a>.</p>

<p>This release includes updates of the following gems:</p>

<ul>
<li><a href="https://rubygems.org/gems/rom">rom 0.6.1</a> - <a href="https://github.com/rom-rb/rom/blob/master/CHANGELOG.md#v061-2015-04-04">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-sql">rom-sql 0.4.1</a> - <a href="https://github.com/rom-rb/rom-sql/blob/master/CHANGELOG.md#v041-2015-04-04">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-rails">rom-rails 0.3.1</a> - <a href="https://github.com/rom-rb/rom-rails/blob/master/CHANGELOG.md#v031-2015-04-04">changelog</a></li>
<li><a href="https://rubygems.org/gems/rom-lotus">rom-lotus 0.0.1</a> - <a href="https://github.com/rom-rb/rom-lotus/blob/master/CHANGELOG.md">changelog</a></li>
</ul>

<h2 id="auto-mapping-of-command-results">Auto-mapping of command results</h2>

<p>The results of commands can now be mapped in the same way as relations, using <code>as</code> or <code>map_with</code>.</p>
<pre class="highlight ruby"><code><span class="n">rom</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">:rel_name</span><span class="p">).</span><span class="nf">as</span><span class="p">(</span><span class="ss">:mapper_name</span><span class="p">)</span>
</code></pre>

<h2 id="new-migrations-interface">New migrations interface</h2>

<p>A database migration interface is now included in <code>rom-sql</code>. This is currently a thin wrapper around the excellent <a href="http://sequel.jeremyevans.net/rdoc/files/doc/migration_rdoc.html">Sequel Migrations API</a>.</p>

<p>You can use migrations with one or more repositories as follows:</p>
<pre class="highlight ruby"><code><span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span>
  <span class="ss">default: </span><span class="p">[</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'sqlite::memory'</span><span class="p">],</span>
  <span class="ss">other: </span><span class="p">[</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'postgres://localhost/test'</span><span class="p">]</span>
<span class="p">)</span>

<span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span>

<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">migration</span> <span class="k">do</span>
  <span class="n">change</span> <span class="k">do</span>
    <span class="n">create_table</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">primary_key</span> <span class="ss">:id</span>
      <span class="no">String</span> <span class="ss">:name</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># for a non-default repository</span>
<span class="no">ROM</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">migration</span><span class="p">(</span><span class="ss">:other</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>

<p>The expected way to run migrations is to require the Rake task from <code>rom/sql/rake_task</code>, and provide a <code>db:setup</code> task that sets up the ROM connection.</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'sqlite3'</span>
<span class="nb">require</span> <span class="s1">'rom/sql/rake_task'</span>

<span class="n">namespace</span> <span class="ss">:db</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:setup</span> <span class="k">do</span>
    <span class="no">ROM</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="ss">:sql</span><span class="p">,</span> <span class="s1">'sqlite::memory'</span><span class="p">)</span>
    <span class="no">ROM</span><span class="p">.</span><span class="nf">finalize</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="improvements-to-forms-for-rails-users">Improvements to forms for Rails users</h2>

<p>There are several new changes that rationalize and improve the usability of the Rails forms API:</p>

<ul>
<li>An optional <code>mappings</code> declaration has been added, which applies named mappers to the results of form commands.</li>
<li>Form generators can generate a shared base form class for new/update forms.</li>
<li><code>input</code> and <code>validations</code> blocks are now available in all descendants of <code>ROM::Model::Form</code>.</li>
</ul>

<p>The following example shows what this looks like in action, with base attributes and validations shared by the child classes, which each declare their own command, mapper, and attribute inputs:</p>
<pre class="highlight ruby"><code><span class="c1"># app/forms/user_form.rb</span>
<span class="k">class</span> <span class="nc">UserForm</span> <span class="o">&lt;</span> <span class="no">ROM</span><span class="o">::</span><span class="no">Model</span><span class="o">::</span><span class="no">Form</span>
  <span class="n">input</span> <span class="k">do</span>
    <span class="n">set_model_name</span> <span class="s1">'User'</span>

    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span>
    <span class="n">attribute</span> <span class="ss">:email</span><span class="p">,</span> <span class="no">String</span>
  <span class="k">end</span>

  <span class="n">validations</span> <span class="k">do</span>
    <span class="n">relation</span> <span class="ss">:users</span>

    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
    <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">uniqueness: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/forms/new_user_form.rb</span>
<span class="k">class</span> <span class="nc">NewUserForm</span> <span class="o">&lt;</span> <span class="no">UserForm</span>
  <span class="n">commands</span> <span class="ss">users: :create</span>

  <span class="n">mappings</span> <span class="ss">users: :entity</span>

  <span class="n">input</span> <span class="k">do</span>
    <span class="n">timestamps</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">commit!</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="n">users</span><span class="p">.</span><span class="nf">create</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/forms/update_user_form.rb</span>
<span class="k">class</span> <span class="nc">UpdateUserForm</span> <span class="o">&lt;</span> <span class="no">UserForm</span>
  <span class="n">commands</span> <span class="ss">users: :update</span>

  <span class="n">mappings</span> <span class="ss">users: :entity</span>

  <span class="n">input</span> <span class="k">do</span>
    <span class="n">timestamps</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">commit!</span>
    <span class="n">users</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="n">users</span><span class="p">.</span><span class="nf">update</span><span class="p">.</span><span class="nf">by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h2 id="lotus-integration">Lotus integration</h2>

<p>And last but not least, <a href="https://github.com/rom-rb/rom-lotus">rom-lotus</a> is out shiny new integration with the <a href="http://lotusrb.org/">Lotus Framework</a>.</p>

<p>A very basic setup example:</p>
<pre class="highlight ruby"><code><span class="c1"># config/environment.rb</span>
<span class="nb">require</span> <span class="s1">'lotus/setup'</span>
<span class="nb">require</span> <span class="s1">'rom-lotus'</span>

<span class="nb">require_relative</span> <span class="s1">'../apps/web/application'</span>

<span class="no">Lotus</span><span class="o">::</span><span class="no">Container</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">mount</span> <span class="no">Web</span><span class="o">::</span><span class="no">Application</span><span class="p">,</span> <span class="ss">at: </span><span class="s1">'/'</span>

  <span class="no">ROM</span><span class="o">::</span><span class="no">Lotus</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="no">Web</span><span class="o">::</span><span class="no">Application</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">setup</span><span class="o">|</span>
    <span class="n">setup</span><span class="p">.</span><span class="nf">repositories</span><span class="p">[</span><span class="ss">:default</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:sql</span><span class="p">,</span> <span class="s2">"sqlite:///tmp/test.sqlite"</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Expect to hear more about this as the integration evolves.</p>

<h2 id="upgrading-to-0-6-1">Upgrading to 0.6.1</h2>

<p>Please let us know if you have any trouble with the upgrade. Contact us directly via <a href="https://gitter.im/rom-rb/chat">Gitter</a> or <a href="https://github.com/rom-rb/rom/issues">submit an issue on GitHub</a> describing any problems you&rsquo;re having.</p>

<h2 id="onwards-to-0-7">Onwards to 0.7</h2>

<p>We’re planning to focus heavily on improvements to mappers and commands in 0.7, which should get us significantly closer to figuring out what the shape of these APIs will be in 1.0.</p>

<p>Thanks for your support!</p>
</div><div class="article-footer"><hr /><div class="article-social"><ul><li><div class="share"></div></li><li><a href="/blog/2015/04/04/rom-0-6-1-released#disqus_thread">Leave a comment</a></li></ul></div><hr /><div class="article-comments"><div id="disqus_thread"><script>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'rom-rb-blog'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></div></div></div></article></section></div><div class="col-md-4"><aside><div class="blog-sidebar panel panel-default"><div class="panel-heading"><div class="panel-title">Wherein we talk about ROM</div></div><div class="panel-body"><a class="subscribe btn btn-info" href="http://rom-rb.org/blog/feed.xml">Subscribe</a></div></div><div class="tag-sidebar panel panel-default"><div class="panel-heading"><div class="panel-title">Browse tags</div></div><ul class="blog-tags"><li><span class="badge">5</span><a href="/blog/tags/release/">release</a></li><li><span class="badge">6</span><a href="/blog/tags/announcement/">announcement</a></li><li><span class="badge">1</span><a href="/blog/tags/oss/">oss</a></li><li><span class="badge">1</span><a href="/blog/tags/support/">support</a></li></ul></div></aside></div></div></div></div></div></div><footer><div class="container"><div class="social"><div class="github"><iframe allowtransparency="true" frameborder="0" height="20" scrolling="0" src="http://ghbtns.com/github-btn.html?user=rom-rb&repo=rom&type=watch&count=true" width="110"></iframe></div><div class="twitter"><a class="twitter-follow-button" data-show-count="true" data-show-screen-name="false" href="https://twitter.com/rom_rb">Follow</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div></div><div class="muted copyright">Ruby Object Mapper &copy; 2014-2015</div></div></footer></body></html>